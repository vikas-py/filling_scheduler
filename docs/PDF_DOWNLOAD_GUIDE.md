# PDF Report Download Guide

**Last Updated**: October 14, 2025
**Status**: ‚úÖ Fully Implemented

## üìÑ How to Download PDF Reports

### Prerequisites

**Backend Dependencies** (must be installed first):
```bash
pip install weasyprint Jinja2 plotly kaleido openpyxl Pillow
```

**System Requirements for WeasyPrint**:

- **Windows**: Install GTK+ runtime from https://github.com/tschoonj/GTK-for-Windows-Runtime-Environment-Installer
- **Ubuntu/Debian**: `sudo apt-get install libcairo2 libpango-1.0-0 libgdk-pixbuf2.0-0`
- **macOS**: `brew install cairo pango gdk-pixbuf`

### Step-by-Step Guide

#### 1. Start the Application
```bash
# Terminal 1: Start backend
uvicorn src.fillscheduler.api.main:app --reload

# Terminal 2: Start frontend
cd frontend
npm run dev
```

#### 2. Navigate to a Schedule
1. Open your browser to http://localhost:5173
2. Log in to your account
3. Go to "Schedules" page
4. Click on any **completed** schedule

#### 3. Download Reports

You'll see **5 export buttons** at the top of the schedule detail page:

| Button | Format | Description |
|--------|--------|-------------|
| **CSV** | `.csv` | Activity list as comma-separated values |
| **JSON** | `.json` | Raw schedule data in JSON format |
| **Excel** | `.xlsx` | Formatted Excel workbook with multiple sheets |
| **PDF Report** | `.pdf` | Professional PDF with charts and analysis |
| **Chart PNG** | `.png` | High-resolution Gantt chart image |

#### 4. Generate PDF Report

1. Click the **"PDF Report"** button (blue, prominent)
2. A loading dialog appears: "Generating report with charts and statistics..."
3. Wait 5-10 seconds (depends on schedule size)
4. PDF automatically downloads to your Downloads folder
5. Open the PDF to view your professional report

---

## üìä What's Included in the PDF Report

### Page 1: Cover Page
- Schedule name and title
- Strategy used (MILP, LPT, etc.)
- Status badge
- Generation timestamp
- Generated by username

### Page 2: Executive Summary
- **4 Key Metric Cards**:
  - Makespan (total time in hours)
  - Utilization percentage
  - Number of changeovers
  - Total lots scheduled
- Activity type legend (Fill/Clean/Changeover)

### Page 3: Schedule Timeline
- **Full Gantt Chart** (timeline visualization)
- Color-coded by activity type:
  - üîµ Blue = Fill activities
  - üü† Orange = Clean activities
  - üî¥ Red = Changeover activities
- Time axis showing hours from start
- Resources (Filler 1, 2, 3, etc.) on Y-axis

### Page 4: Resource Utilization
- **Stacked Area Chart** showing filler usage over time
- Hour-by-hour breakdown
- Activity type distribution
- **Pie Chart** showing Fill vs Clean vs Changeover percentages

### Page 5: Filler Breakdown
- **Table with per-filler statistics**:
  - Total activities per filler
  - Fill/Clean/Changeover counts
  - Lots processed
  - Total time utilized

### Page 6: Activity Details
- **Comprehensive table** with first 50 activities:
  - Lot ID
  - Filler assigned
  - Activity type
  - Start/end times
  - Duration
  - Lot type (if available)

### Page 7: Configuration
- All input parameters in a grid layout
- Number of fillers
- Clean times
- Strategy settings
- Constraints and rules

### Page 8: Validation Results
- Errors (if any) in red box
- Warnings (if any) in orange box
- Success message if no issues

---

## üìà Excel Export

Click the **"Excel"** button to download a formatted `.xlsx` workbook with:

### Sheet 1: Summary
- Key metrics (Makespan, Utilization, etc.)
- Schedule metadata
- Strategy information

### Sheet 2: Activities
- **Full activity list** (all activities, not limited to 50)
- Sortable columns
- Color-coded headers
- Professional formatting

### Sheet 3: Configuration
- Parameter list with values
- Easy to reference

**Benefits**:
- Import into Excel/Google Sheets for analysis
- Create custom charts and pivot tables
- Filter and sort activities
- Calculate custom metrics

---

## üñºÔ∏è Other Export Formats

### CSV Export
- Plain text format
- Opens in Excel, Google Sheets, or any spreadsheet tool
- Good for data import/processing
- Activity list with all fields

### JSON Export
- Raw data format
- Useful for API integration
- Programmatic processing
- Complete schedule structure

### Chart PNG Export
- High-resolution Gantt chart image (2x scale)
- For presentations and documentation
- Transparent or white background
- Captures exactly what you see on screen

---

## ‚öôÔ∏è Advanced Options

### PDF Generation Options

The backend endpoint supports an optional parameter:

```
GET /api/v1/schedule/{id}/export?format=pdf&include_charts=true
```

**Parameters**:
- `format`: `pdf`, `excel`, `csv`, or `json`
- `include_charts`: `true` or `false` (PDF/Excel only)
  - `true` (default): Include all charts (takes 5-10 seconds)
  - `false`: Text-only report (faster, 1-2 seconds)

### Customization

To customize PDF templates:
1. Edit `src/fillscheduler/reporting/templates/schedule_report.html`
2. Modify CSS styles in the `<style>` section
3. Add/remove sections as needed
4. Change colors, fonts, layout

---

## üêõ Troubleshooting

### "PDF generation not available" Error

**Problem**: Backend dependencies not installed

**Solution**:
```bash
pip install weasyprint Jinja2 plotly kaleido openpyxl Pillow
```

Also install system dependencies (GTK+ on Windows, Cairo on Linux/Mac).

### "Failed to generate PDF report" Error

**Problem**: Missing schedule data or chart generation failed

**Solutions**:
1. Check that schedule is completed (status = "completed")
2. Verify activities exist in the schedule
3. Check backend logs for detailed error:
   ```bash
   # Look for error messages in terminal running uvicorn
   ```
4. Try without charts: Add `&include_charts=false` to URL

### PDF Downloads but is Corrupted

**Problem**: Incomplete download or encoding issue

**Solutions**:
1. Check browser's Downloads folder
2. Try a different browser
3. Clear browser cache
4. Check network connection during download

### Excel Export Opens with Errors

**Problem**: Excel compatibility issue

**Solutions**:
1. Use Microsoft Excel 2016 or later
2. Try Google Sheets (fully compatible)
3. Use LibreOffice Calc

### Slow PDF Generation (>30 seconds)

**Problem**: Large schedule with many activities

**Solutions**:
1. Use `include_charts=false` for faster generation
2. Check server CPU usage
3. Optimize chart generation settings
4. Consider pagination for very large schedules (100+ lots)

---

## üîí Security & Permissions

### Authentication Required
- All export endpoints require valid JWT token
- Token automatically included by frontend
- API returns 401 Unauthorized if not logged in

### Access Control
- Users can only export their own schedules
- Schedule ID ownership verified in backend
- No access to other users' data

---

## üöÄ API Reference

### Export Endpoint

```http
GET /api/v1/schedule/{schedule_id}/export
```

**Query Parameters**:
| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `format` | string | Yes | `json` | Export format: `json`, `csv`, `pdf`, `excel` |
| `include_charts` | boolean | No | `true` | Include charts in PDF/Excel |

**Headers**:
```http
Authorization: Bearer {jwt_token}
```

**Response**:
- **200 OK**: File download with appropriate Content-Type
  - `application/pdf` for PDF
  - `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet` for Excel
  - `text/csv` for CSV
  - `application/json` for JSON
- **400 Bad Request**: Schedule not completed
- **401 Unauthorized**: Not authenticated
- **404 Not Found**: Schedule not found or not owned by user
- **500 Internal Server Error**: Generation failed
- **501 Not Implemented**: Dependencies not installed

**Example with cURL**:
```bash
# PDF Report
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8000/api/v1/schedule/1/export?format=pdf" \
  -o report.pdf

# Excel Report
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:8000/api/v1/schedule/1/export?format=excel" \
  -o report.xlsx
```

---

## üìù Development Notes

### Testing PDF Generation

Run standalone test:
```bash
cd src/fillscheduler/reporting
python pdf_generator.py
```

This generates `test_report.pdf` with sample data.

### Testing Excel Generation

```bash
cd src/fillscheduler/reporting
python excel_generator.py
```

This generates `test_report.xlsx` with sample data.

### Chart Generation Performance

Typical generation times on modern hardware:
- Gantt Chart: 1-2 seconds
- Utilization Chart: 0.5-1 second
- Pie Chart: 0.3-0.5 seconds
- **Total PDF**: 5-8 seconds for 50 activities

For very large schedules (200+ activities):
- Consider pagination
- Use `include_charts=false` for faster text reports
- Optimize chart rendering settings

---

## üéØ Quick Reference

**I want to...**

| Goal | Action |
|------|--------|
| Share results with stakeholders | Click **"PDF Report"** ‚Üí Email the PDF |
| Analyze data in Excel | Click **"Excel"** ‚Üí Open in Excel/Sheets |
| Include chart in presentation | Click **"Chart PNG"** ‚Üí Insert in PowerPoint |
| Process data programmatically | Click **"JSON"** ‚Üí Use in scripts/tools |
| Import into database | Click **"CSV"** ‚Üí Import into SQL/database |

---

**Document Version**: 1.0
**Author**: Development Team
**Status**: Production Ready ‚úÖ
